if("undefined"==typeof jQuery)throw new Error("Tabledit requires jQuery library.");!function(t){"use strict";var e={init:function(e){function n(t){var e={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"","'":"","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};return String(t).replace(/[&<>"'`=\/]/g,function(t){return e[t]})}function i(e){function n(t){var e=null;if(document.cookie&&""!=document.cookie)for(var n=document.cookie.split(";"),i=0;i<n.length;i++){var a=jQuery.trim(n[i]);if(a.substring(0,t.length+1)==t+"="){e=decodeURIComponent(a.substring(t.length+1));break}}return e}function i(t){return/^(GET|HEAD|OPTIONS|TRACE)$/.test(t)}var s,r,u=a.find(".tabledit-input").serialize();return!!u&&(u+="&action="+e,!1!==(r=l.onAjax(e,u))&&(u=r,l.method=l[e+"method"],t.ajaxSetup({beforeSend:function(t,e){i(e.type)||this.crossDomain||t.setRequestHeader("X-CSRFToken",n("csrftoken"))}}),(s=t.ajax({url:l.url,type:l.method,data:u,dataType:"json"})).done(function(t,n,i){"success"==n?(e===l.buttons.edit.action&&(o.removeClass(l.dangerClass).addClass(l.successClass),setTimeout(function(){a.find("tr."+l.successClass).removeClass(l.successClass)},1500)),l.onSuccess(t,n,i)):l.onFail(n)}),s.fail(function(t,n,i){e===l.buttons.delete.action?(d.removeClass(l.mutedClass).addClass(l.dangerClass),d.find(".tabledit-toolbar button").attr("disabled",!1),d.find(".tabledit-toolbar .tabledit-restore-button").hide()):e===l.buttons.edit.action&&o.addClass(l.dangerClass),l.onFail(t,n,i),console.log("Tabledit Ajax fail => "+n+" : "+i)}),s.always(function(){l.onAlways()}),s))}var a=this;if("TABLE"!==a.prop("tagName"))throw new Error("Tabledit only works when applied to a table.");var s=function(t){return void 0!==t||null!==t||""!==t};if(!s(e.columns))return console.log("Tabledit Jquery Plugin not initialize. Set required parameters."),this;s(e.lang)&&e.lang in a.Tabledit.langs?e.lang=e.lang.toLowerCase():e.lang=a.Tabledit.defaults.lang;var l=t.extend({},a.Tabledit.defaults,e);t(this).data("_TableditData",t.extend({},a.Tabledit.defaults,e||{}));var o="undefined",d="undefined",r="undefined";if(l.editButton&&l.buttons.edit.html)u=l.buttons.edit.html;else var u=a.Tabledit.langs[l.lang].btn_edit;if(l.deleteButton&&l.buttons.delete.html)b=l.buttons.delete.html;else var b=a.Tabledit.langs[l.lang].btn_delete;if(l.confirmButton&&l.buttons.confirm.html)c=l.buttons.confirm.html;else var c=a.Tabledit.langs[l.lang].btn_confirm;if(l.saveButton&&l.buttons.save.html)f=l.buttons.save.html;else var f=a.Tabledit.langs[l.lang].btn_save;if(l.restoreButton&&l.buttons.restore.html)p=l.buttons.restore.html;else var p=a.Tabledit.langs[l.lang].btn_restore;e.debug&&console.log("Tabledit Init -> Element:",a),e.debug&&console.log("Tabledit Init -> dataPrefix:","_TableditData"),e.debug&&console.log("Tabledit Init -> Settings: ",l),e.debug&&console.log("Tabledit Init: -----------------------------------");var h={columns:{identifier:function(){l.hideIdentifier&&a.find("th:nth-child("+parseInt(l.columns.identifier[0])+"1), tbody td:nth-child("+parseInt(l.columns.identifier[0])+"1)").hide(),a.find('tbody tr:not(".'+l.noEditClass+'") td:not(".'+l.noEditClass+'")').filter(":nth-child("+(parseInt(l.columns.identifier[0])+1)+")").each(function(){var e=t.trim(t(this).text().replace(/^\s+|\s+$/g,"")),i='<span class="tabledit-span tabledit-identifier">'+(e=l.escapehtml?n(e):e)+"</span>",a='<input class="tabledit-input tabledit-identifier" type="hidden" name="'+l.columns.identifier[1]+'" value="'+e+'" disabled>';t(this).html(i+a),t(this).parent("tr").attr(l.rowIdentifier,t.trim(t(this).text()))})},editable:function(){for(var e=0;e<l.columns.editable.length;e++)a.find('tbody tr:not(".'+l.noEditClass+'") td:not(".'+l.noEditClass+'")').filter(":nth-child("+(parseInt(l.columns.editable[e][0])+1)+")").each(function(){var i=t.trim(t(this).text().replace(/(^\s+|\s+$)/g,"")),i=l.escapehtml?n(i):i;l.editButton||t(this).css("cursor","pointer");var s,o='<span class="tabledit-span">'+i+"</span>",d=["input","hidden","number","date","select","textarea"],r=["rows","cols","maxlength","wrap"],u=l.columns.editable[e][2];switch(-1==t.inArray(u,d)&&(u="input"),u){case"input":s='<input class="tabledit-input '+l.inputClass+'" type="text" name="'+l.columns.editable[e][1]+'" value="'+i+'" style="display: none;" disabled>';break;case"hidden":s='<input class="tabledit-input '+l.inputClass+'" type="hidden" name="'+l.columns.editable[e][1]+'" value="'+i+'" style="display: none;" disabled>';break;case"number":s='<input class="tabledit-input '+l.inputClass+'" type="number" name="'+l.columns.editable[e][1]+'" value="'+i+'" style="display: none;" disabled>';break;case"date":s='<input class="tabledit-input '+l.inputClass+'" type="date" name="'+l.columns.editable[e][1]+'" value="'+i+'" style="display: none;" disabled>';break;case"select":void 0!==l.columns.editable[e][3]&&(s='<select class="tabledit-input '+l.inputClass+'" name="'+l.columns.editable[e][1]+'" style="display: none;" disabled>',t.each(t.parseJSON(l.columns.editable[e][3]),function(e,n){n=t.trim(n),s+=i===n?'<option value="'+e+'" selected>'+n+"</option>":'<option value="'+e+'">'+n+"</option>"}),s+="</select>");break;case"textarea":var b;s="<textarea ",void 0!==l.columns.editable[e][3]?t.each(t.parseJSON(l.columns.editable[e][3]),function(e,n){s+=-1!=t.inArray(e,r)?e+'="'+n+'" ':"",b="maxlength"==e&&n.length>0?a.Tabledit.langs[l.lang].txt_allowchar.replace("%s",n)+' | <span class="countno_"></span> '+a.Tabledit.langs[l.lang].txt_remain:a.Tabledit.langs[l.lang].txt_nolimit}):b=a.Tabledit.langs[l.lang].txt_nolimit,s+=' class="tabledit-input '+l.inputClass+'" name="'+l.columns.editable[e][1]+'" style="display: none;" disabled>'+i+'</textarea><span class="count_" style="display: none;">'+b+"</span>"}t(this).html(o+s),t(this).addClass("tabledit-view-mode")})},toolbar:function(){if(l.editButton||l.deleteButton){var t="",e="",n="",i="",s="";0===a.find("th.tabledit-toolbar-column").length&&a.find("tr:first").append('<th class="tabledit-toolbar-column '+l.toolbarHeaderClass+'">'+a.Tabledit.langs[l.lang].txt_action+"</th>"),l.editButton&&(t='<button type="button" class="tabledit-edit-button '+l.buttons.edit.class+'" style="float: none;">'+u+"</button>"),l.deleteButton&&(e='<button type="button" class="tabledit-delete-button '+l.buttons.delete.class+'" style="float: none; ">'+b+"</button>",s='<button type="button" class="tabledit-confirm-button '+l.buttons.confirm.class+'" style="display: none; float: none; margin-left: 10px;">'+c+"</button>"),l.editButton&&l.saveButton&&(n='<button type="button" class="tabledit-save-button '+l.buttons.save.class+'" style="display: none; float: none; margin-left: 10px;">'+f+"</button>"),l.deleteButton&&l.restoreButton&&(i='<button type="button" class="tabledit-restore-button '+l.buttons.restore.class+'" style="display: none; float: none; margin-left: 10px;">'+p+"</button>");var o='<div class="tabledit-toolbar '+l.toolbarClass+'" style="text-align: left;flex-wrap: nowrap;">\n                                           <div class="'+l.groupClass+'" style="float: none;">'+t+e+"</div>\n                                           "+n+"\n                                           "+s+"\n                                           "+i+"\n                                       </div></div>";a.find('tbody > tr:not(".'+l.noEditClass+'")').append('<td class="toolbar" style="white-space: nowrap; width: 1%;">'+o+"</td>"),a.find("tbody > tr."+l.noEditClass).append('<td class="toolbar" style="white-space: nowrap; width: 1%;"></td>')}}}},m={view:function(e){var n=t(e).parent("tr");t(e).parent("tr").find(".tabledit-input.tabledit-identifier").prop("disabled",!0),t(e).find(".tabledit-input").blur().hide().prop("disabled",!0),t(e).find(".count_").hide(),t(e).find(".tabledit-span").show(),t(e).addClass("tabledit-view-mode").removeClass("tabledit-edit-mode"),l.editButton&&(n.find("button.tabledit-save-button").hide(),n.find("button.tabledit-edit-button").removeClass("active").blur())},edit:function(e){g.reset(e);var n=t(e).parent("tr");n.find(".tabledit-input.tabledit-identifier").prop("disabled",!1),t(e).find(".tabledit-span").hide();var i=t(e).find(".tabledit-input");i.prop("disabled",!1).show(),t(e).find("textarea").css({resize:"none"}),t(e).find(".count_").css({color:"#CCC",display:"block",float:"right"}).show(),t(e).find(".countno_").html("..."),l.autoFocus&&i.focus(),t(e).addClass("tabledit-edit-mode").removeClass("tabledit-view-mode"),l.editButton&&(n.find("button.tabledit-edit-button").addClass("active"),n.find("button.tabledit-save-button").show())}},v={reset:function(e){t(e).each(function(){var e=t(this).find(".tabledit-input"),n=t.trim(t(this).find(".tabledit-span").text());e.is("select")?e.find("option").filter(function(){return t.trim(t(this).text())===n}).attr("selected",!0):e.val(n),m.view(this)})},submit:function(e){!1!==i(l.buttons.edit.action)&&(t(e).each(function(){var e=t(this).find(".tabledit-input");e.is("select")?t(this).find(".tabledit-span").text(t.trim(e.find("option:selected").text())):t(this).find(".tabledit-span").text(e.val()),m.view(this)}),o=t(e).parent("tr"))}},g={reset:function(t){a.find(".tabledit-confirm-button").hide(),a.find(".tabledit-delete-button").removeClass("active").blur()},submit:function(e){g.reset(e),t(e).parent("tr").find("input.tabledit-identifier").attr("disabled",!1);var n=i(l.buttons.delete.action);t(e).closest("tr").find("input.tabledit-identifier").attr("disabled",!0),!1!==n&&(t(e).parent("tr").addClass("tabledit-deleted-row"),t(e).parent("tr").addClass(l.mutedClass).find(".tabledit-toolbar button:not(.tabledit-restore-button)").attr("disabled",!0),t(e).find(".tabledit-restore-button").show(),d=t(e).parent("tr"))},confirm:function(e){a.find("td.tabledit-edit-mode").each(function(){v.reset(this)}),t(e).find(".tabledit-delete-button").addClass("active"),t(e).find(".tabledit-confirm-button").show()},restore:function(e){t(e).parent("tr").find("input.tabledit-identifier").attr("disabled",!1);var n=i(l.buttons.restore.action);t(e).closest("tr").find("input.tabledit-identifier").attr("disabled",!0),!1!==n&&(t(e).parent("tr").removeClass("tabledit-deleted-row"),t(e).parent("tr").removeClass(l.mutedClass).find(".tabledit-toolbar button").attr("disabled",!1),t(e).find(".tabledit-restore-button").hide(),r=t(e).parent("tr"))}};return h.columns.identifier(),h.columns.editable(),h.columns.toolbar(),l.onDraw(),l.deleteButton&&(a.on("click","button.tabledit-delete-button",function(e){if(!0!==e.handled){e.preventDefault();var n=t(this).hasClass("active"),i=t(this).closest("td");g.reset(i),n||g.confirm(i),e.handled=!0}}),a.on("click","button.tabledit-confirm-button",function(e){if(!0!==e.handled){e.preventDefault();var n=t(this).closest("td");g.submit(n),e.handled=!0}})),l.restoreButton&&a.on("click","button.tabledit-restore-button",function(e){!0!==e.handled&&(e.preventDefault(),g.restore(t(this).closest("td")),e.handled=!0)}),l.editButton?(a.on("click","button.tabledit-edit-button",function(e){if(!0!==e.handled){e.preventDefault();var n=t(this),i=n.hasClass("active");v.reset(a.find("td.tabledit-edit-mode")),i||t(n.closest("tr").find("td.tabledit-view-mode").get().reverse()).each(function(){m.edit(this)}),e.handled=!0}}),a.on("click","button.tabledit-save-button",function(e){!0!==e.handled&&(e.preventDefault(),v.submit(t(this).closest("tr").find("td.tabledit-edit-mode")),e.handled=!0)})):(a.on(l.eventType,"tr:not(.tabledit-deleted-row) td.tabledit-view-mode",function(t){!0!==t.handled&&(t.preventDefault(),v.reset(a.find("td.tabledit-edit-mode")),m.edit(this),t.handled=!0)}),a.on("change","select.tabledit-input:visible",function(e){!0!==e.handled&&(v.submit(t(this).parent("td")),e.handled=!0)}),t(document).on("click",function(t){var e=a.find(".tabledit-edit-mode");e.is(t.target)||0!==e.has(t.target).length||v.reset(a.find(".tabledit-input:visible").parent("td"))})),a.on("keypress",function(t){var e=a.find(".tabledit-input:visible"),n=a.find(".tabledit-confirm-button");if(e.length>0)i=e.parents("td");else{if(!(n.length>0))return;var i=n.parents("td")}switch(t.keyCode){case 9:l.editButton||(v.submit(i),m.edit(i.closest("td").next()));break;case 13:t.preventDefault(),v.submit(i);break;case 27:v.reset(i),g.reset(i)}}),t("textarea").on("change keyup keydown",function(){var e=t(this).val().length,n=t(this).attr("maxlength");if(void 0!==n&&!1!==n&&n.length>0){e=n-e;t(this).parent().find(".countno_").text(e)}}),this},destroy:function(e){var n=this;e.debug&&console.log("Tabledit Destroy -> Element:",t(this)),n.find(".tabledit-toolbar-column").remove(),n.find(".toolbar").remove(),n.find("td").each(function(){if(0!=t(this).find(".tabledit-input").length)e=t.trim(t(this).find(".tabledit-span").text());else var e=t.trim(t(this).html());t(this).html(e)})},update:function(n){var i=t(this).data("_TableditData");if(i){(n=t.extend(!0,i,n)).debug&&console.log("Tabledit Update -> Element:",t(this)),n.debug&&console.log("Tabledit Update -> Settings: ",n);var a=t.parseJSON(JSON.stringify(n,["debug"]));e.destroy.apply(this,[a]),e.init.apply(this,[n])}else console.log("Tabledit Update -> Data: EditTable must be initialized before setting options")}};t.fn.Tabledit=function(n){return e[n]?e[n].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof n&&n?void t.error("Method "+n+" does not exist on jQuery.Tabledit"):e.init.apply(this,arguments)},t.fn.Tabledit.defaults={url:window.location.href,editmethod:"post",deletemethod:"post",toolbarHeaderClass:"",toolbarClass:"btn-toolbar",groupClass:"btn-group btn-group-sm",inputClass:"form-control input-sm",dangerClass:"danger",successClass:"success",mutedClass:"text-muted",noEditClass:"noedit",eventType:"click",rowIdentifier:"id",hideIdentifier:!1,autoFocus:!0,lang:"en",debug:!1,escapehtml:!0,editButton:!0,deleteButton:!0,saveButton:!0,restoreButton:!0,buttons:{edit:{class:"btn btn-sm btn-default",html:'<span class="glyphicon glyphicon-pencil"></span>',action:"edit"},delete:{class:"btn btn-sm btn-default",html:'<span class="glyphicon glyphicon-trash"></span>',action:"delete"},save:{class:"btn btn-sm btn-success",html:""},restore:{class:"btn btn-sm btn-warning",html:"",action:"restore"},confirm:{class:"btn btn-sm btn-danger",html:"Confirm"}},onDraw:function(){},onSuccess:function(){},onFail:function(){},onAlways:function(){},onAjax:function(){}},t.fn.Tabledit.langs={en:{btn_edit:"Edit",btn_delete:"Delete",btn_confirm:"Confirm",btn_save:"Save",btn_restore:"Restore",txt_action:"Actions",txt_nolimit:"Count of characters without limit",txt_allowchar:"Allowed count of characters %s",txt_remain:"characters remaining"},de:{btn_edit:"Editieren",btn_delete:"L&ouml;schen",btn_confirm:"Best&auml;tigen",btn_save:"Speichern",btn_restore:"Inhalt",txt_action:"Aktion",txt_nolimit:"",txt_allowchar:"",txt_remain:""},fr:{btn_edit:"Editer",btn_delete:"Supprimer",btn_confirm:"Confirmer",btn_save:"Enregistrer",btn_restore:"Restaurer",txt_action:"Actions",txt_nolimit:"Nombre de caractères sans limite",txt_allowchar:"Nombre de caractères autorisés %s",txt_remain:"caractères restants"},cz:{btn_edit:"Editovat",btn_delete:"Odstranit",btn_confirm:"Potvrdit",btn_save:"Uložit",btn_restore:"Obnovit",txt_action:"Akce",txt_nolimit:"Počet znaků bez omezení",txt_allowchar:"Povoleno celkem %s znaků",txt_remain:"znak(ů) zbývá"}}}(jQuery);